---
allowed-tools: Bash(git:*), Bash(gh:*)
argument-hint: [base-branch] ["rationale"]
description: Create a pull request with auto-generated description
---

## Context

- Current branch: !`git branch --show-current`
- Arguments: $ARGUMENTS
  - If arguments contain a quoted string, extract it as the rationale
  - The remaining argument (if any) is the base branch (defaults to master)
- Git status: !`git status --short`

## Instructions

Create a pull request for the current branch. Follow these steps:

1. **Handle uncommitted changes on master/main**:
   If on master/main branch with uncommitted changes (staged or unstaged):
   - Analyze the changes to auto-generate a descriptive feature branch name (e.g., `feat/add-user-auth`, `fix/login-validation`)
   - Stage all changes: `git add -A`
   - Create and switch to the feature branch: `git checkout -b <feature-branch>`
   - Commit with a one-liner message in conventional commit format (no footer)
   - Reset master/main to match origin: `git branch -f master origin/master` (or main)

2. **Gather information** (run these in parallel):
   - Check if the current branch is a feature branch, otherwise create one and reset master
   - Check if the current branch tracks a remote and is up to date
   - Get the diff between current branch and base branch: `git diff <base-branch>...HEAD`
   - Get the commit history since diverging from base: `git log <base-branch>..HEAD --oneline`
   - Check if a PR is already opened for the current branch

3. **Push if needed**:
   - If the branch is not pushed or is ahead of remote, push with: `git push -u origin <current-branch>`

4. **Process rationale** (if provided):
   - Proofread and spell check the rationale sentence
   - Fix any typos or grammatical errors
   - Keep the original intent and meaning intact

5. **Generate PR description**:
   Analyze all commits and changes to create a comprehensive PR description with:
   - A clear, concise title following conventional commit format
   - A summary section with 2-4 bullet points explaining the changes
   - If a rationale was provided, include the proofread version in a "## Rationale" section

6. **Look for issues resolved by the PR** in the current repo using `gh issue list --state open`. If any issues are resolved by the PR, add "Fixes #<issue number>" to the PR body for each issue

7. **Create or update the PR**:
   Use the following body template:
   ```
   ## Rationale
   <proofread rationale sentence, only if provided>

   ## Summary
   - First change description
   - Second change description
   ```

   - If no PR exists for the current branch: `gh pr create --draft --title "<title>" --body "<body>"`
   - If a PR already exists: `gh pr edit --title "<title>" --body "<body>"`

8. **Return the PR URL** so the user can review it.

## Important

- Use conventional commit format for the PR title (feat:, fix:, chore:, docs:, refactor:, test:)
- The PR title should explain "why" not just "what"
- If base branch is not provided, default to `master`
- Do NOT add any "Generated by" footers
- Always open new PRs as draft
